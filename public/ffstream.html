<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>ffstream tools</title>
	<link rel="icon" href="crow.ico?" type="image/x-icon">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<meta property="og:type" content="article"/>
	<meta property="og:title" content="ffstream tools"/>
	<link rel="feed" type="application/rss+xml" title="Mineral Existence RSS Feed" href="https://mineralexistence.com/feed.xml">

	<!-- the below sections enables syntax highlighting when js is enabled, and reverts to the default when it isn't -->
	<noscript>
		<style>
			pre {
				font-size:calc(0.5rem + 0.25vw);
				line-height:2.3ex;
				overflow-x:auto; 
				padding:2%; 
				color:var(--bg);
				background-color:var(--text); 
			}
		</style>
	</noscript>
	<script src="./assets/prism.js" defer></script>

	
	<script>
		var link = document.createElement("link");
		link.rel="stylesheet";
		link.href="./assets/prism.css";
		link.type="text/css";
		document.getElementsByTagName("head")[0].appendChild(link);

		window.onload = function() {
			var seed = Math.floor(Math.random() * 10000000);
			var noise = document.getElementById('noise');
			noise.setAttribute("seed", seed)
		}
	</script>

	<style>
/* @import url('reset.css'); */

*, *::before, *::after {box-sizing: border-box;} 
* {margin: 0;} 
body {line-height: 1.5;-webkit-font-smoothing: antialiased;}
img, picture, video, canvas, svg {display: block;max-width: 100%;}
input, button, textarea, select {font: inherit;} 
p, h1, h2, h3, h4, h5, h6 {overflow-wrap: break-word;} 
#root, #__next {isolation: isolate;} 

:root {
	/* --text:#3A3738; */
	/* --text:#472d30; */
	--text:#654735;
	/* --bg:#FBF0F0; */
	/* --bg:#ffe1a8; */
	--bg:#fbf1c7; 
	/* --hl:#80dec5; */
	/* --hl:#c9cba3; */
	--hl:#45707a;
	--hl-orange:#c35e0a;
}

body {
	font-size:calc(1rem + 0.5vw);
	font-family:Times;
	max-width:72ch;
	margin: 3rem auto 3rem; 
	padding: 0 1rem; 
	line-height:1.6;
	color:var(--text);
	background-color:var(--bg);
}

/* * {border: 1px solid black;} */

.content > *+* {margin-top: 2ex;}

*:not(footer)>a {color:var(--hl);}
*:not(footer)>a:visited {color:var(--hl-orange);}
*:not(footer)>a[href*=':']::before{content:"â†—"}

header>h1 {display:inline-block;padding-right:.3em;}
header {margin: 0 0 1em 0;clear:both;}

.content { position: relative; padding: 2em;}
.content-bg {
	position: absolute;
	top:0;
	left:0;
	width: 100%;
	height: 100%;
	z-index:-1;
}

mark {background-color:var(--hl);color:var(--bg);}
hr {height:1px;border-width:0;color:var(--text);background-color:var(--text)} 

pre {
	font-size:calc(0.5rem + 0.25vw);
	line-height:2.3ex;
	overflow-x:auto; 
	padding:2%; 
	color:var(--bg); 
	background-color:var(--text); 
}
code {color:var(--bg);background-color:var(--text);font-size:calc(0.8rem + 0.5vw);padding-left: 0.2em;padding-right: 0.2em;} 

button {
	border-radius: 30px;
	border: 1px solid var(--text);
	background: none;
	padding: 0px 10px;
	font-weight: bold;
	font-family: sans;
	color: var(--text);
	font-size: 20px;
}
button:hover {color: var(--bg);background: var(--text);}

dd {margin-left:2em;}
details {padding-bottom:0ex;}
fieldset {border:1px solid;}
::selection {color: var(--bg);background-color: var(--text);}

.half {width: 50%; height: auto;}
.third {width: 31%; height: auto;}
.left {margin-top: 0em;float: left;margin-right: 2em;clear: both;}
.block {margin-top: 1em;margin-left: 0px;clear: both;}
.container {padding: 2ex; border: solid 1px var(--text);border-radius: 5px;}
.row {display: flex;}
.column {flex: 50%;}
.listing > span {float: right;}
.box {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(256px, 1fr));
	gap: 0.5em;
	grid-auto-flow: dense;
}

.inline-img {
	height: 33px;
	display: inline-block;
	border: 1px solid var(--text);
	position: relative;
	left: 0.25em;
	top: 0.25ex;
}


footer {margin:1em 0 0 0;clear:both}
footer>* {display:inline-block;}
footer img {margin:0 0 -10px 0;width:30px;} 

	</style>

</head>

<body>
	<header>
		<h1><a href="home.html">Home</a></h1> 
		<h1><a href="now.html">now</a></h1>
		<h1><a href="wiki.html">wiki</a></h1>
		<h1><a href="about.html">about</a></h1>
	</header>

	<main>
		<div class="content">	
			<div class="content-bg">
				<svg width="100%" height="100%">
					<defs> 
						<filter id="filter"> 
							<feTurbulence id="noise" seed="31415632" baseFrequency="0.005" numOctaves="1" type="fractalNoise" result="result1" /> 
							<feDisplacementMap in2="result1" scale="16" result="result2" xChannelSelector="R" in="SourceGraphic" /> 
							<feComposite in2="result2" in="SourceGraphic" operator="atop" result="fbSourceGraphic" /> 
						</filter> 
					</defs> 
					<rect rx="32" fill="#fcd297" filter="url(#filter)" width="98%" height="98%" x="5" y="5" /> 
					<!-- <rect rx="32" fill="#fcd297" width="98%" height="98%" x="5" y="5" /> -->
				</svg>
			</div>

<h2>ffstream tools</h2>

<p><a href="https://github.com/flber/ffstream">ffstream</a> is really a loose collection of scripts and miscellaneous files, and is my setup for streaming (to twitch.tv in my case) using ffmpeg! At the moment the main section is stuff which "just works" (lol not really) and an <code>extra/</code> directory for experimental ffmpeg ramblings. The long-term goal is to turn it into a compiled, cross-platform application which is <em>actually useful</em>, but the short-term goal is to actually have something working :)</p>

<p>This project started because my laptop <mark>page coming soon :)</mark> really struggles to run OBS and any other software, so streaming games and such was never really feasible. However, after messing around with ffmpeg to encode video and such for months, I realized its (commonly) untapped potential for streaming!</p>

<p>ffmpeg is an <em>incredibly</em> impressive piece of software; it can convert from basically any format to any other with more options than almost anyone will ever use, <em>and that's still not the coolest thing it can do!</em> Unfortunately I won't be going over ffmpeg's awesome complex filter system in this article, as it's a little outside of the scope :/</p>

<p>The current main tool in this repo is the script <code>ffst-main</code>, which is a pretty basic script to stream your desktop to twitch. It's only 14 lines, and could be 1 if I didn't care about readability :)</p>

<pre>
#!/bin/bash

dunstify "starting stream"

size=$(xrandr | head -n1 | cut -d, -f2 | cut -d" " -f3-5 | sed 's/ //g')

ffmpeg -f x11grab \
  -video_size $size \
  -framerate 24 -i $DISPLAY \
  -f alsa -ac 2 -i pulse -acodec aac \
  -vf scale=1280x720 \
  -c:v h264 -g 24 -b:v 2M \
  -preset ultrafast -vb 3200k \
  -c:a aac -pix_fmt yuv420p \
  -f flv "rtmp://live-lax.twitch.tv/app/$STREAM_KEY"
</pre>

<p>The <code>dunstify</code> call is mostly to let me know the script is still working, and you could replace the <code>size</code> variable with a hardcoded value of your display's dimensions. Most of the ffmpeg flags just set formats and such, but a few flags deserve explanation</p>

<dl>
	<dt><code>-f x11grab</code></dt>
	<dd>uses the x11 server api to get desktop video</dd>
	<dt><code>-video_size $size ... -i $DISPLAY</code></dt>
	<dd>using x11grab, sets the video dimensions to your screen's values, and the input to your current display</dd>
	<dt><code>-f alsa -ac 2 -i pulse -acodec aac</code></dt>
	<dd>adds a second input for desktop audio from alsa and pulseaudio</dd>
	<dt><code>-f flv "rtmp://live-lax.twitch.tv/app/$STREAM_KEY"</code></dt>
	<dd>sets the output format to one commonly supported by streaming sites, and the output source to twitch</dd>
</dl>

			<p><b>Incoming:</b> <a href=".html"></a> <a href=".html"></a> </p>
		</div>
	</main>

	<footer>
		<a href="mailto:benrhammond@gmail.com" target="_blank">
			<img loading="lazy" width="30" height="30" src="images/mail.svg" alt="Mailto" />
		</a>
		<a rel="me" href="https://merveilles.town/@flbr" target="_blank">
			<img loading="lazy" width="30" height="30" src="images/merveilles.svg" alt="Merveilles" />
		</a>
		<a href='https://webring.xxiivv.com/#icons' target='_blank'>
			<img loading="lazy" width="30" height="30" class="webring" src="images/webring-icon-black.svg" alt="the merveilles webring" />
		</a>
		<a href="https://wiki.xxiivv.com/site/ethics.html">
			<img loading="lazy" width="30" height="30" src="images/dreipfeile-icon.svg" alt="Ethics" />
		</a>
		<a href="feed.xml">
			<img loading="lazy" width="30" height="30" src="images/rss.svg" alt="RSS Feed" />
		</a>
		<img loading="lazy" style="width:88px;height:31px;margin-left:0.5ex;" title="my homemade site banner!" alt="site banner"
			src="images/icon.gif" />
		<span style="float: right;"><em>Last updated: 030323</em></span>
	</footer>
</body>
</html>
