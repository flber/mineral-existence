#!/usr/bin/luajit

Filename = io.stdin:read()
Input = io.stdin:read("*all")

local function scandir(directory)
  local i, t, popen = 0, {}, io.popen
  local pfile = popen('ls -a "'..directory..'"')
  for filename in pfile:lines() do
      i = i + 1
      t[i] = filename
  end
  pfile:close()
  return t
end

local function generate_feed()
  local xml = [[<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">\n\t<channel>\n\t\t<title>Mineral Existence</title>\n\t\t<description>an internet garden, tended with love and affection</description>\n\t\t<link>https://mineralexistence.com</link>\n\t\t<language>en</language>\n]]

  local xml_pages = {}

  local file = io.input(".pillar.toml"):read("a")
  local granite_re = "granite_path = \"([^\"]+)\""
  local html_re = "html_path = \"([^\"]+)\""

  local granite_path = file:match(granite_re)
  local html_path = file:match(html_re)

  local pages = scandir(granite_path)
end

if Input:find("{{rss}}") then
  generate_feed()
  print(Input:gsub("{{rss}}", ""))
else
  print(Input)
end
